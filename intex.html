<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Прыгай, Робо!</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
    }

    body {
      background: #0f0c29;
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #gameContainer {
      position: relative;
      width: 100vw;
      height: 100vh;
      max-width: 500px;
      max-height: 800px;
      margin: 0 auto;
    }

    #gameCanvas {
      display: block;
      background: #1a1a3a;
    }

    #startScreen, #gameOverScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(15, 12, 41, 0.9);
      z-index: 10;
      text-align: center;
      padding: 20px;
    }

    .hidden {
      display: none !important;
    }

    button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 18px;
      background: #ff6b6b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background: #ff5252;
    }

    a {
      color: #4fc3f7;
      text-decoration: none;
      margin-top: 15px;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
    <div id="startScreen">
      <h1>Прыгай, Робо!</h1>
      <p>Нажми, чтобы прыгнуть и собрать звёздочки!</p>
      <button id="startBtn">Старт</button>
    </div>
    <div id="gameOverScreen" class="hidden">
      <h2 id="resultText">Ты собрал 0 звёзд!</h2>
      <button id="restartBtn">Играть снова</button>
      <p><a href="https://ваш-сайт.рф?utm_source=bus_qr&utm_medium=game" target="_blank">Хочешь больше таких игр? Запишись на курс!</a></p>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Адаптация под экран
    function resizeCanvas() {
      canvas.width = Math.min(window.innerWidth, 500);
      canvas.height = Math.min(window.innerHeight, 800);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Элементы интерфейса
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const resultText = document.getElementById('resultText');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');

    // Игровые переменные
    let gameRunning = false;
    let score = 0;
    let gameTime = 0;
    const gameDuration = 60; // секунд

    // Робот
    const robot = {
      x: 50,
      y: canvas.height - 100,
      width: 40,
      height: 40,
      vy: 0,
      onGround: true
    };

    // Платформы и звёзды
    let platforms = [];
    let stars = [];

    function initGame() {
      score = 0;
      gameTime = 0;
      robot.y = canvas.height - 100;
      robot.vy = 0;
      robot.onGround = true;

      // Генерация платформ и звёзд
      platforms = [
        { x: 0, y: canvas.height - 40, width: canvas.width }
      ];
      stars = [];
      for (let i = 0; i < 10; i++) {
        stars.push({
          x: 150 + i * 80 + Math.random() * 40,
          y: canvas.height - 120 - Math.random() * 200,
          collected: false
        });
      }
    }

    function jump() {
      if (robot.onGround) {
        robot.vy = -12;
        robot.onGround = false;
      }
    }

    canvas.addEventListener('click', () => {
      if (gameRunning) jump();
    });

    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (gameRunning) jump();
    });

    startBtn.addEventListener('click', () => {
      startScreen.classList.add('hidden');
      initGame();
      gameRunning = true;
      gameLoop();
    });

    restartBtn.addEventListener('click', () => {
      gameOverScreen.classList.add('hidden');
      initGame();
      gameRunning = true;
      gameLoop();
    });

    function update() {
      if (!gameRunning) return;

      gameTime += 1 / 60;

      // Гравитация
      robot.vy += 0.5;
      robot.y += robot.vy;

      // Проверка платформ
      robot.onGround = false;
      for (const p of platforms) {
        if (
          robot.x + robot.width > p.x &&
          robot.x < p.x + p.width &&
          robot.y + robot.height <= p.y &&
          robot.y + robot.height + robot.vy >= p.y
        ) {
          robot.y = p.y - robot.height;
          robot.vy = 0;
          robot.onGround = true;
        }
      }

      // Сбор звёзд
      for (const star of stars) {
        if (!star.collected &&
            robot.x < star.x + 20 &&
            robot.x + robot.width > star.x &&
            robot.y < star.y + 20 &&
            robot.y + robot.height > star.y) {
          star.collected = true;
          score++;
        }
      }

      // Проверка окончания
      if (robot.y > canvas.height || gameTime >= gameDuration) {
        endGame();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Робот (простой квадрат)
      ctx.fillStyle = '#4fc3f7';
      ctx.fillRect(robot.x, robot.y, robot.width, robot.height);

      // Платформы
      ctx.fillStyle = '#4caf50';
      for (const p of platforms) {
        ctx.fillRect(p.x, p.y, p.width, 20);
      }

      // Звёзды
      ctx.fillStyle = '#ffeb3b';
      for (const star of stars) {
        if (!star.collected) {
          ctx.beginPath();
          ctx.arc(star.x + 10, star.y + 10, 8, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      // Счёт и таймер
      ctx.fillStyle = 'white';
      ctx.font = '16px Arial';
      ctx.fillText(`Звёзд: ${score}/10`, 10, 25);
      ctx.fillText(`Время: ${Math.max(0, Math.floor(gameDuration - gameTime))} с`, 10, 45);
    }

    function endGame() {
      gameRunning = false;
      resultText.textContent = `Ты собрал ${score} из 10 звёзд!`;
      gameOverScreen.classList.remove('hidden');
    }

    function gameLoop() {
      if (!gameRunning) return;
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>